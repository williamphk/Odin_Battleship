!function(){"use strict";const e=(e,t,l,n)=>{if(t>4||t<1)throw new Error("Wrong Length");return{shipName:e,shipLength:t,direction:l,group:n,array:[...Array(t)],hit(e){if(e>=this.array.shipLength||e<0)throw new Error("Wrong Position");this.array[e]="hit"},isSink(){return this.array.every((e=>"hit"===e))}}},t=()=>Math.floor(10*Math.random()),l=()=>Math.floor(10*Math.random()),n=()=>{let e=Math.floor(2*Math.random());return 0===e?"horizontal":1===e?"vertical":void 0},a=()=>({board:[[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null]],placeShip(e,n,a,o,r=0){let i=!0;if("horizontal"===o){console.log("horizontal");for(let t=0;t<a.shipLength;t++)console.log("checking available",e,n+t-r," for ship ",a),console.log("10",this.board[e][10]),(null!==this.board[e][n+t-r]&&this.board[e][n+t-r]!==a||void 0===this.board[e][n+t-r])&&(i=!1);if(i){console.log("placed!"),this.board[e][n]=a;for(let t=0;t<a.shipLength;t++)this.board[e][n+t]=a}else i||(console.log("random!"),this.placeShip(t(),l(),a,o,r))}else if("vertical"===o){console.log("vertical");for(let t=0;t<a.shipLength;t++)console.log("checking available",e+t-r,n," for ship ",a),e+a.shipLength>9?(console.log("Out of range!"+e),i=!1):(null!==this.board[e+t-r][n]&&this.board[e+t-r][n]!==a||void 0===this.board[e+t-r][n])&&(i=!1);if(i){console.log("placed!"),this.board[e][n]=a;for(let t=0;t<a.shipLength;t++)this.board[e+t][n]=a}else i||(console.log("random!"),this.placeShip(t(),l(),a,o,r));console.log(this.board)}},removeShip(e,t,l,n){if("horizontal"===n)for(let n=0;n<l.shipLength;n++)this.board[e][t+n]=null;else if("vertical"===n)for(let n=0;n<l.shipLength;n++)this.board[e+n][t]=null},receiveAttack(e,t){"ship"===this.board[e][t]||"object"==typeof this.board[e][t]&&null!=this.board[e][t]?this.board[e][t]="hit":null===this.board[e][t]&&(this.board[e][t]="missed")},isMiss(e,t){return"missed"===this.board[e][t]},isHit(e,t){return"hit"===this.board[e][t]},isAllShipSink(){return!this.board.some((e=>e.some((e=>"object"==typeof e&&null!==e||"ship"===e))))},hitCount(){let e=0;for(let t=0;t<this.board.length;t++)for(let l=0;l<this.board[t].length;l++)"hit"===this.board[t][l]&&e++;return e}}),o=e=>({name:e});function r(e,t,l){if(!0===l)return;let n=Number(e.srcElement.parentElement.parentElement.attributes[1].value),a=Number(e.srcElement.parentElement.parentElement.attributes[2].value),o=t.board[n][a],r=Number(e.srcElement.parentElement.dataset.length),i=32*r+r-1,d=!0;if("horizontal"===o.direction){for(let e=1;e<o.shipLength;e++)null===t.board[n+e][a]&&void 0!==t.board[n+e][a]||(d=!1);if(console.log(d),!1===d)return;e.srcElement.parentElement.style.flexDirection="column",e.srcElement.parentElement.style.width="32px",e.srcElement.parentElement.style.height=i+"px",t.removeShip(n,a,o,"horizontal"),t.placeShip(n,a,o,"vertical"),o.direction="vertical"}else if("vertical"===o.direction){for(let e=1;e<o.shipLength;e++)null===t.board[n][a+e]&&void 0!==t.board[n][a+e]||(d=!1);if(console.log(d),!1===d)return;e.srcElement.parentElement.style.flexDirection="row",e.srcElement.parentElement.style.width=i+"px",e.srcElement.parentElement.style.height="32px",t.removeShip(n,a,o,"vertical"),t.placeShip(n,a,o,"horizontal"),o.direction="horizontal"}}function i(e,t){console.log(e),!0!==t&&(e.dataTransfer.setData("target",e.target.id),e.dataTransfer.setData("target-length",e.target.dataset.length),e.dataTransfer.setData("srcX",e.srcElement.parentElement.attributes[1].value),e.dataTransfer.setData("srcY",e.srcElement.parentElement.attributes[2].value))}function d(e,t){!0!==t&&(console.log("dragover"),e.preventDefault(),e.dataTransfer.dropEffect="move")}function c(e,t,l,n){if(console.log("drop"),!0===l)return;e.preventDefault();let a=e.dataTransfer.getData("target"),o=e.dataTransfer.getData("target-length"),r=Number(e.dataTransfer.getData("srcX")),i=Number(e.dataTransfer.getData("srcY")),d=Number(e.target.dataset.x),c=Number(e.target.dataset.y);if(isNaN(d)||isNaN(c))return;let s=t.board[r][i],u=!0;if("horizontal"===s.direction){for(let e=0;e<o;e++)(null!==t.board[d][c+e-n+1]&&t.board[d][c+e-n+1]!==s||void 0===t.board[d][c+e-n+1])&&(u=!1);if(console.log(u),!u)return;u&&(2==n?(d=e.target.dataset.x,c=e.target.dataset.y-1):3==n?(d=e.target.dataset.x,c=e.target.dataset.y-2):4==n&&(d=e.target.dataset.x,c=e.target.dataset.y-3),document.querySelector(`.battle-cell-content.battle-cell-content__player[data-x="${d}"][data-y="${c}"]`).appendChild(document.getElementById(a)),t.removeShip(r,i,s,"horizontal"),t.placeShip(d,c,s,"horizontal",Number(n)-1),console.log(t.board))}else if("vertical"===s.direction){for(let e=0;e<o;e++)(null!==t.board[d+e-n+1][c]&&t.board[d+e-n+1][c]!==s||void 0===t.board[d+e-n+1][c])&&(u=!1);if(console.log(u),!u)return;u&&(2==n?(d=e.target.dataset.x-1,c=e.target.dataset.y):3==n?(d=e.target.dataset.x-2,c=e.target.dataset.y):4==n&&(d=e.target.dataset.x-3,c=e.target.dataset.y),document.querySelector(`.battle-cell-content.battle-cell-content__player[data-x="${d}"][data-y="${c}"]`).appendChild(document.getElementById(a)),t.removeShip(r,i,s,"vertical"),t.placeShip(d,c,s,"vertical",Number(n)-1),console.log(t.board))}}const s=(e,n,a,o,r,i,d)=>{if(a.isHit(e,n)||a.isMiss(e,n))s(t(),l(),a,o,r,i);else{a.receiveAttack(e,n);let t=document.querySelector(`[class$="battle-cell-content battle-cell-content__player"][data-x="${e}"][data-y="${n}"]`),l=t.innerHTML;const d=document.querySelector(".result");if(a.isHit(e,n))if(console.log("x",e,"y",n),l){var c=document.createElement("div");c.style.backgroundColor="red",c.style.position="absolute",c.style.top="0",c.style.width="100%",c.style.height="100%",c.style.zIndex="10",c.innerHTML="H",t.appendChild(c),document.getElementById("hit-count").innerHTML=`You hit: ${i.hitCount()} AI hit: ${a.hitCount()}`}else t.style.position="relative",t.innerHTML="H",t.style.zIndex="3",t.style.backgroundColor="red";else a.isMiss(e,n)&&(t.innerHTML="M");a.isAllShipSink()?(d.innerHTML="AI win",document.getElementById("start-btn").innerHTML="Restart",document.getElementById("start-btn").onclick=()=>{window.location.reload()}):o.turn=r.name}};function u(e,t,l){const n=document.createElement("div");return n.className="ship",n.id="drag"+e,n.setAttribute("data-length",t),n.setAttribute("draggable",!0),n.style.width=l,n}function h(e){const t=document.createElement("div");return t.className="ship-sub-div",t.style.width="32px",t.style.height="32px",t.setAttribute("data-div",e),t}!function(){console.log("dom");const e=document.querySelector(".player-battlefield"),t=document.querySelector(".bot-battlefield"),l=document.createElement("table"),n=document.createElement("table");console.log(l,n),l.className="battlefield-table-container__player",n.className="battlefield-table-container__bot",e.appendChild(l),t.appendChild(n);for(let e=0;e<10;e++){const t=document.createElement("tr"),a=document.createElement("tr");t.className="battiefield-row__player",a.className="battiefield-row__bot",l.appendChild(t),n.appendChild(a);for(let l=0;l<10;l++){const n=document.createElement("td"),o=document.createElement("td");n.className="battlefield-cell",o.className="battlefield-cell";const r=document.createElement("div"),i=document.createElement("div");r.className="battle-cell-content battle-cell-content__player",i.className="battle-cell-content battle-cell-content__bot",r.dataset.x=e,r.dataset.y=l,i.dataset.x=e,i.dataset.y=l,t.appendChild(n),a.appendChild(o),n.appendChild(r),o.appendChild(i)}}const a=u(1,1,"32px"),o=u(2,1,"32px"),r=u(3,1,"32px"),i=u(4,1,"32px"),d=u(5,2,"65px"),c=u(6,2,"65px"),s=u(7,2,"65px"),p=u(8,3,"98px"),b=u(9,3,"98px"),m=u(10,4,"131px"),y=h(1),g=h(1),f=h(1),S=h(1),v=h(1),E=h(2),C=h(1),x=h(2),z=h(1),_=h(2),L=h(1),N=h(2),q=h(3),M=h(1),T=h(2),A=h(3),w=h(1),H=h(2),k=h(3),I=h(4);a.appendChild(y),o.appendChild(g),r.appendChild(f),i.appendChild(S),d.appendChild(v),d.appendChild(E),c.appendChild(C),c.appendChild(x),s.appendChild(z),s.appendChild(_),p.appendChild(L),p.appendChild(N),p.appendChild(q),b.appendChild(M),b.appendChild(T),b.appendChild(A),m.appendChild(w),m.appendChild(H),m.appendChild(k),m.appendChild(I),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="0"][data-y="0"]').appendChild(a),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="0"][data-y="3"]').appendChild(o),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="0"][data-y="6"]').appendChild(r),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="0"][data-y="9"]').appendChild(i),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="2"][data-y="1"]').appendChild(d),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="2"][data-y="7"]').appendChild(c),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="3"][data-y="4"]').appendChild(s),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="6"][data-y="1"]').appendChild(p),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="6"][data-y="6"]').appendChild(b),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="8"][data-y="3"]').appendChild(m)}();let p=!1;const b=e("ship1",1,"horizontal","player"),m=e("ship2",1,"horizontal","player"),y=e("ship3",1,"horizontal","player"),g=e("ship4",1,"horizontal","player"),f=e("ship5",2,"horizontal","player"),S=e("ship6",2,"horizontal","player"),v=e("ship7",2,"horizontal","player"),E=e("ship8",3,"horizontal","player"),C=e("ship9",3,"horizontal","player"),x=e("ship10",4,"horizontal","player"),z=e("ship1",1,"horizontal","bot"),_=e("ship2",1,"horizontal","bot"),L=e("ship3",1,"horizontal","bot"),N=e("ship4",1,"horizontal","bot"),q=e("ship5",2,"horizontal","bot"),M=e("ship6",2,"horizontal","bot"),T=e("ship7",2,"horizontal","bot"),A=e("ship8",3,"horizontal","bot"),w=e("ship9",3,"horizontal","bot"),H=e("ship10",4,"horizontal","bot");let k=a(),I=a();console.log(k),console.log(I),I.placeShip(t(),l(),z,n()),I.placeShip(t(),l(),_,n()),I.placeShip(t(),l(),L,n()),I.placeShip(t(),l(),N,n()),I.placeShip(t(),l(),q,n()),I.placeShip(t(),l(),M,n()),I.placeShip(t(),l(),T,n()),I.placeShip(t(),l(),A,n()),I.placeShip(t(),l(),w,n()),I.placeShip(t(),l(),H,n()),k.placeShip(0,0,b,"horizontal"),k.placeShip(0,3,m,"horizontal"),k.placeShip(0,6,y,"horizontal"),k.placeShip(0,9,g,"horizontal"),k.placeShip(2,1,f,"horizontal"),k.placeShip(2,7,S,"horizontal"),k.placeShip(3,4,v,"horizontal"),k.placeShip(6,1,E,"horizontal"),k.placeShip(6,6,C,"horizontal"),k.placeShip(8,3,x,"horizontal"),console.log(k.board);let $=o("Player"),D=o("Bot");console.log($);const B={turn:$.name};document.querySelectorAll(".battle-cell-content__bot").forEach(((e,n)=>{e.addEventListener("click",(()=>function(e,n,a,o,r,i,d,c,u){if(!a)return;if(o.turn===u.name)return;if("。"===e.innerHTML)return;if(d)return;const h=document.getElementById("hit-count");h.innerHTML=`You hit: ${r.hitCount()} AI hit: ${i.hitCount()}`;const p=document.querySelectorAll(".battle-cell-content__bot"),b=document.querySelector(".result");e.innerHTML="。",r.receiveAttack(p[n].dataset.x,p[n].dataset.y),r.isAllShipSink()?(b.innerHTML="You win",h.innerHTML=`You hit: ${r.hitCount()} AI hit: ${i.hitCount()}`,d=!0,document.getElementById("start-btn").innerHTML="Restart",document.getElementById("start-btn").onclick=()=>{window.location.reload()}):(o.turn=u.name,s(t(),l(),i,o,c,r,d))}(e,n,p,B,I,k,!1,$,D)))}));let Y=null;const j=document.querySelectorAll(".ship-sub-div");for(let e=0;e<j.length;e++)j[e].addEventListener("mouseover",(e=>{Y=e.target.getAttribute("data-div"),console.log(Y)}));const P=document.querySelectorAll(".ship");for(let e=0;e<P.length;e++)P[e].addEventListener("click",(e=>r(e,k,p))),P[e].addEventListener("dragstart",(e=>i(e,p))),P[e].addEventListener("dragend",(e=>{}));const R=document.querySelectorAll(".battlefield-cell");for(let e=0;e<R.length;e++)R[e].addEventListener("dragover",(e=>d(e,p))),R[e].addEventListener("drop",(e=>c(e,k,p,Y)));document.getElementById("start-btn").onclick=()=>{document.querySelectorAll(".battlefield-cell").forEach((e=>{e.style.borderTop="0.5px solid rgb(0, 38, 255)",e.style.borderLeft="0.5px solid rgb(0, 38, 255)",e.style.backgroundColor="rgb(228, 228, 228)"})),p=!0}}();