!function(){"use strict";const t=(t,e,l,n)=>{if(e>4||e<1)throw new Error("Wrong Length");return{shipName:t,shipLength:e,direction:l,group:n,array:[...Array(e)],hit(t){if(t>=this.array.shipLength||t<0)throw new Error("Wrong Position");this.array[t]="hit"},isSink(){return this.array.every((t=>"hit"===t))}}},e=()=>Math.floor(10*Math.random()),l=()=>Math.floor(10*Math.random()),n=()=>{let t=Math.floor(2*Math.random());return 0===t?"horizontal":1===t?"vertical":void 0},a=()=>({board:[[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null]],placeShip(t,n,a,o){let r=!0;if("horizontal"===o){for(let e=0;e<a.shipLength;e++)null===this.board[t][n+e]&&void 0!==this.board[t][n+e]||(r=!1);if(r){for(let e=0;e<a.shipLength;e++)this.board[t][n+e]=a;this.board[t][n]=a}else r||this.placeShip(e(),l(),a,o)}else if("vertical"===o){for(let e=0;e<a.shipLength;e++)(this.board[t+e]?.[n]||void 0===this.board[t+e]?.[n])&&(r=!1);if(r){for(let e=0;e<a.shipLength;e++)this.board[t+e][n]=a;this.board[t][n]=a}else r||this.placeShip(e(),l(),a,o)}},removeShip(t,e,l,n){if("horizontal"===n)for(let n=0;n<l.shipLength;n++)this.board[t][e+n]=null;else if("vertical"===n)for(let n=0;n<l.shipLength;n++)this.board[t+n][e]=null},receiveAttack(t,e){"ship"===this.board[t][e]||"object"==typeof this.board[t][e]&&null!=this.board[t][e]?this.board[t][e]="hit":null===this.board[t][e]&&(this.board[t][e]="missed")},isMiss(t,e){return"missed"===this.board[t][e]},isHit(t,e){return"hit"===this.board[t][e]},isAllShipSink(){return!this.board.some((t=>t.some((t=>"object"==typeof t&&null!==t||"ship"===t))))},hitCount(){let t=0;for(let e=0;e<this.board.length;e++)for(let l=0;l<this.board[e].length;l++)"hit"===this.board[e][l]&&t++;return t}}),o=t=>({name:t});function r(t,e,l){if(!0===l)return;let n=Number(t.srcElement.parentElement.attributes[1].value),a=Number(t.srcElement.parentElement.attributes[2].value),o=e.board[n][a],r=Number(t.target.dataset.length),i=32*r+r-1,c=!0;if("horizontal"===o.direction){for(let t=1;t<o.shipLength;t++)(9-n+1<r||null!==e.board[n+t][a]||void 0===e.board[n+t][a])&&(c=!1);if(console.log(c),!1===c)return;t.target.style.width="32px",t.target.style.height=i+"px",e.removeShip(n,a,o,"horizontal"),e.placeShip(n,a,o,"vertical"),o.direction="vertical"}else if("vertical"===o.direction){for(let t=1;t<o.shipLength;t++)(9-a+1<r||null!==e.board[n][a+t]||void 0===e.board[n][a+t])&&(c=!1);if(console.log(c),!1===c)return;t.target.style.width=i+"px",t.target.style.height="32px",e.removeShip(n,a,o,"vertical"),e.placeShip(n,a,o,"horizontal"),o.direction="horizontal"}}function i(t,e){!0!==e&&(t.dataTransfer.setData("target",t.target.id),t.dataTransfer.setData("target-length",t.target.dataset.length),t.dataTransfer.setData("srcX",t.srcElement.parentElement.attributes[1].value),t.dataTransfer.setData("srcY",t.srcElement.parentElement.attributes[2].value),t.target.classList.add("dragging"))}function c(t,e){!0!==e&&(t.preventDefault(),t.dataTransfer.dropEffect="move")}function s(t,e){!0!==e&&t.target.classList.remove("dragging")}function d(t,e,l){if(!0===l)return;let n=t.dataTransfer.getData("target"),a=t.dataTransfer.getData("target-length"),o=Number(t.dataTransfer.getData("srcX")),r=Number(t.dataTransfer.getData("srcY")),i=Number(t.target.dataset.x),c=Number(t.target.dataset.y);if(isNaN(i)||isNaN(c))return;t.preventDefault();let s=e.board[o][r],d=!0;if("horizontal"===s.direction){for(let t=0;t<a;t++)console.log(i,c+t),console.log(e.board[i][c+t]),(9-c+1<a||null!==e.board[i][c+t]&&e.board[i][c+t]!==s||void 0===e.board[i][c+t])&&(d=!1);if(console.log(d),!1===d)return;t.target.appendChild(document.getElementById(n)),e.removeShip(o,r,s,"horizontal"),e.placeShip(i,c,s,"horizontal")}else if("vertical"===s.direction){for(let t=0;t<a;t++)(9-i+1<a||null!==e.board[i+t][c]&&e.board[i+t][c]!==s||void 0===e.board[i+t][c])&&(d=!1);if(console.log(d),!1===d)return;t.target.appendChild(document.getElementById(n)),e.removeShip(o,r,s,"vertical"),e.placeShip(i,c,s,"vertical")}}function u(t,e,l){const n=document.createElement("div");return n.className="shipbox ship",n.id="drag"+t,n.setAttribute("data-length",e),n.setAttribute("draggable",!0),n.style.width=l,n}!function(){console.log("dom");const t=document.querySelector(".battlefields"),e=document.createElement("table"),l=document.createElement("table");console.log(e,l),e.className="battlefield-table-container__self",l.className="battlefield-table-container__rival",t.appendChild(e),t.appendChild(l);for(let t=0;t<10;t++){const n=document.createElement("tr"),a=document.createElement("tr");n.className="battiefield-row__self",a.className="battiefield-row__rival",e.appendChild(n),l.appendChild(a);for(let e=0;e<10;e++){const l=document.createElement("td"),o=document.createElement("td");l.className="battlefield-cell",o.className="battlefield-cell";const r=document.createElement("div"),i=document.createElement("div");r.className="battle-cell-content battle-cell-content__self",i.className="battle-cell-content battle-cell-content__rival",r.dataset.x=t,r.dataset.y=e,i.dataset.x=t,i.dataset.y=e,n.appendChild(l),a.appendChild(o),l.appendChild(r),o.appendChild(i)}}const n=u(1,1,"32px"),a=u(2,1,"32px"),o=u(3,1,"32px"),r=u(4,1,"32px"),i=u(5,2,"65px"),c=u(6,2,"65px"),s=u(7,2,"65px"),d=u(8,3,"98px"),h=u(9,3,"98px"),p=u(10,4,"131px");document.querySelector('.battle-cell-content.battle-cell-content__self[data-x="0"][data-y="0"]').appendChild(n),document.querySelector('.battle-cell-content.battle-cell-content__self[data-x="0"][data-y="3"]').appendChild(a),document.querySelector('.battle-cell-content.battle-cell-content__self[data-x="0"][data-y="6"]').appendChild(o),document.querySelector('.battle-cell-content.battle-cell-content__self[data-x="0"][data-y="9"]').appendChild(r),document.querySelector('.battle-cell-content.battle-cell-content__self[data-x="2"][data-y="1"]').appendChild(i),document.querySelector('.battle-cell-content.battle-cell-content__self[data-x="2"][data-y="7"]').appendChild(c),document.querySelector('.battle-cell-content.battle-cell-content__self[data-x="3"][data-y="4"]').appendChild(s),document.querySelector('.battle-cell-content.battle-cell-content__self[data-x="6"][data-y="1"]').appendChild(d),document.querySelector('.battle-cell-content.battle-cell-content__self[data-x="6"][data-y="6"]').appendChild(h),document.querySelector('.battle-cell-content.battle-cell-content__self[data-x="8"][data-y="3"]').appendChild(p)}();let h=!1,p=!1;const b=document.getElementById("hit-count"),f=t("ship1",1,"horizontal","self"),m=t("ship2",1,"horizontal","self"),g=t("ship3",1,"horizontal","self"),y=t("ship4",1,"horizontal","self"),v=t("ship5",2,"horizontal","self"),S=t("ship6",2,"horizontal","self"),z=t("ship7",2,"horizontal","self"),_=t("ship8",3,"horizontal","self"),E=t("ship9",3,"horizontal","self"),x=t("ship10",4,"horizontal","self");console.log(f);const L=t("ship1",1,"horizontal","rival"),C=t("ship2",1,"horizontal","rival"),M=t("ship3",1,"horizontal","rival"),T=t("ship4",1,"horizontal","rival"),N=t("ship5",2,"horizontal","rival"),A=t("ship6",2,"horizontal","rival"),H=t("ship7",2,"horizontal","rival"),q=t("ship8",3,"horizontal","rival"),w=t("ship9",3,"horizontal","rival"),I=t("ship10",4,"horizontal","rival");let k=a(),D=a();console.log(k),console.log(D),D.placeShip(e(),l(),f,n()),D.placeShip(e(),l(),m,n()),D.placeShip(e(),l(),g,n()),D.placeShip(e(),l(),y,n()),D.placeShip(e(),l(),v,n()),D.placeShip(e(),l(),S,n()),D.placeShip(e(),l(),z,n()),D.placeShip(e(),l(),_,n()),D.placeShip(e(),l(),E,n()),D.placeShip(e(),l(),x,n()),k.placeShip(0,0,L,"horizontal"),k.placeShip(0,3,C,"horizontal"),k.placeShip(0,6,M,"horizontal"),k.placeShip(0,9,T,"horizontal"),k.placeShip(2,1,N,"horizontal"),k.placeShip(2,7,A,"horizontal"),k.placeShip(3,4,H,"horizontal"),k.placeShip(6,1,q,"horizontal"),k.placeShip(6,6,w,"horizontal"),k.placeShip(8,3,I,"horizontal");let $=o("Player"),B=o("AI");console.log($);const Y=document.querySelectorAll(".battle-cell-content__rival"),j=(document.querySelectorAll(".battle-cell-content__self"),document.querySelector(".result"));Y.forEach(((t,n)=>{t.addEventListener("click",(a=>{h&&P.turn!==B.name&&"。"!==t.innerHTML&&(b.innerHTML=`You hit: ${D.hitCount()} AI hit: ${k.hitCount()}`,p||(t.innerHTML="。",D.receiveAttack(Y[n].dataset.x,Y[n].dataset.y),D.isAllShipSink()?(j.innerHTML="You win",b.innerHTML=`You hit: ${D.hitCount()} AI hit: ${k.hitCount()}`,p=!0,document.getElementById("start-btn").innerHTML="Restart",document.getElementById("start-btn").onclick=()=>{window.location.reload()}):(P.turn=B.name,R(e(),l()))))}))}));const P={turn:$.name},R=(t,n)=>{if(k.isHit(t,n)||k.isMiss(t,n))R(e(),l());else{k.receiveAttack(t,n);let e=document.querySelector(`[class$="battle-cell-content battle-cell-content__self"][data-x="${t}"][data-y="${n}"]`),l=e.innerHTML;if(k.isHit(t,n))if(console.log("x",t,"y",n),l){var a=document.createElement("div");a.style.backgroundColor="red",a.style.position="absolute",a.style.top="0",a.style.width="100%",a.style.height="100%",a.style.zIndex="10",a.innerHTML="H",e.appendChild(a),b.innerHTML=`You hit: ${D.hitCount()} AI hit: ${k.hitCount()}`}else e.style.position="relative",e.innerHTML="H",e.style.zIndex="3",e.style.backgroundColor="red";else k.isMiss(t,n)&&(e.innerHTML="M");k.isAllShipSink()?(j.innerHTML="AI win",p=!0,document.getElementById("start-btn").innerHTML="Restart",document.getElementById("start-btn").onclick=()=>{window.location.reload()}):P.turn=$.name}},W=document.querySelectorAll(".ship");for(let t=0;t<W.length;t++)W[t].addEventListener("click",(t=>r(t,k,h))),W[t].addEventListener("dragstart",(t=>i(t,h))),W[t].addEventListener("dragend",(t=>s(t,h)));const X=document.querySelectorAll(".battlefield-cell");for(let t=0;t<X.length;t++)X[t].addEventListener("dragover",(t=>c(t,h))),X[t].addEventListener("drop",(t=>d(t,k,h)));document.getElementById("start-btn").onclick=()=>{h=!0}}();