!function(){"use strict";const e=e=>{const t=document.querySelector(".how-to-play"),l=document.querySelector(".game"),a=screen.width;switch(e.target.innerHTML){case"Home":default:t.style.transition="transform 0.5s ease-in-out",t.style.transform=`translateX(${-a}px)`,l.style.transition="transform 0.5s ease-in-out",l.style.transform="translateX(0px)";break;case"How To Play":t.style.transition="transform 0.5s ease-in-out",t.style.transform=`translateX(${a}px)`,l.style.transition="transform 0.5s ease-in-out",l.style.transform=`translateX(${a}px)`;break;case"Source Code":console.log("Source Code")}},t=(e,t,l)=>{const a=document.createElement("div");return a.className="ship",a.id="drag"+e,a.setAttribute("data-length",t),a.setAttribute("draggable",!0),a.style.width=l,a},l=e=>{const t=document.createElement("div");return t.className="ship-sub-div",t.setAttribute("data-div",e),t},a=(e,t,l,a,n)=>{document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="0"][data-y="0"]').appendChild(e),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="2"][data-y="0"]').appendChild(t),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="4"][data-y="0"]').appendChild(l),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="6"][data-y="0"]').appendChild(a),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="8"][data-y="0"]').appendChild(n)},n=e=>({name:e}),r=(e,t,l,a)=>{if(t>5||t<1)throw new Error("Wrong Length");return{shipName:e,shipLength:t,direction:l,group:a,array:[...Array(t)],hit(e){if(e>=this.array.shipLength||e<0)throw new Error("Wrong Position");this.array[e]="hit"}}},o=()=>Math.floor(10*Math.random()),i=()=>Math.floor(10*Math.random()),d=()=>{let e=Math.floor(2*Math.random());return 0===e?"horizontal":1===e?"vertical":void 0},s=e=>({board:[[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null]],placeShip(e,t,l,a){let n=!0;if("horizontal"===a){for(let a=0;a<l.shipLength;a++)(null!==this.board[e][t+a]&&this.board[e][t+a]!==l||void 0===this.board[e][t+a])&&(n=!1);if(n){this.board[e][t]=l;for(let a=0;a<l.shipLength;a++)this.board[e][t+a]=l}else n||this.placeShip(o(),i(),l,a)}else if("vertical"===a){for(let a=0;a<l.shipLength;a++)(e+l.shipLength-1>9||null!==this.board[e+a][t]&&this.board[e+a][t]!==l||void 0===this.board[e+a][t])&&(n=!1);if(n){this.board[e][t]=l;for(let a=0;a<l.shipLength;a++)this.board[e+a][t]=l}else n||this.placeShip(o(),i(),l,a)}},removeShip(e,t,l,a){if("horizontal"===a)for(let a=0;a<l.shipLength;a++)this.board[e][t+a]=null;else if("vertical"===a)for(let a=0;a<l.shipLength;a++)this.board[e+a][t]=null},receiveAttack(e,t){"ship"===this.board[e][t]||"object"==typeof this.board[e][t]&&null!=this.board[e][t]?this.board[e][t]="hit":null===this.board[e][t]&&(this.board[e][t]="missed")},isMiss(e,t){return"missed"===this.board[e][t]},isHit(e,t){return"hit"===this.board[e][t]},isAllShipSink(){return!this.board.some((e=>e.some((e=>"object"==typeof e&&null!==e||"ship"===e))))},resetBoard(){for(let e=0;e<10;e++)for(let t=0;t<10;t++)this.board[e][t]=null},probabilityBoard:[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],calculateProbability(){let t=0,l=!0,a=!0;for(let n=0;n<10;n++)for(let r=0;r<10;r++)if("hit"!==this.board[n][r]&&"missed"!==this.board[n][r]){"hit"===this.board[n][r+1]&&(this.probabilityBoard[n][r]=this.probabilityBoard[n][r]+100),n<9&&"hit"===this.board[n+1][r]&&(this.probabilityBoard[n][r]=this.probabilityBoard[n][r]+100),r>0&&"hit"===this.board[n][r-1]&&(this.probabilityBoard[n][r]=this.probabilityBoard[n][r]+100),n>0&&"hit"===this.board[n-1][r]&&(this.probabilityBoard[n][r]=this.probabilityBoard[n][r]+100);for(let o=0;o<e.length;o++)if(!0!==e[o].isSink){t=e[o].shipLength;for(let e=0;e<t;e++)"hit"!==this.board[n][r+e]&&"missed"!==this.board[n][r+e]&&void 0!==this.board[n][r+e]||(l=!1);if(l)for(let e=0;e<t;e++)this.probabilityBoard[n][r+e]++;else l||(l=!0);for(let e=0;e<t;e++)n+t>10?a=!1:"hit"!==this.board[n+t-1][r]&&"missed"!==this.board[n+t-1][r]&&void 0!==this.board[n+t-1][r]||(a=!1);if(a)for(let e=0;e<t;e++)this.probabilityBoard[n+e][r]++;else a||(a=!0)}}else this.probabilityBoard[n][r]=0},bestNextMove(){let e=0,t=0,l=0;for(let a=0;a<10;a++)for(let n=0;n<10;n++)this.probabilityBoard[a][n]>e&&(e=this.probabilityBoard[a][n],t=a,l=n);return[t,l]},setProbabilityBoardToZero(){for(let e=0;e<10;e++)for(let t=0;t<10;t++)this.probabilityBoard[e][t]=0}}),c=(e,t,l,a,n,r,s,c,p,h,u,m)=>{u.resetBoard(),m.resetBoard(),m.placeShip(o(),i(),r,d()),m.placeShip(o(),i(),s,d()),m.placeShip(o(),i(),c,d()),m.placeShip(o(),i(),p,d()),m.placeShip(o(),i(),h,d()),u.placeShip(0,0,e,"horizontal"),u.placeShip(2,0,t,"horizontal"),u.placeShip(4,0,l,"horizontal"),u.placeShip(6,0,a,"horizontal"),u.placeShip(8,0,n,"horizontal")},p=(e,t,l)=>{if(!0===l)return;let a=Number(e.srcElement.parentElement.parentElement.attributes[1].value),n=Number(e.srcElement.parentElement.parentElement.attributes[2].value),r=t.board[a][n],o=Number(e.srcElement.parentElement.dataset.length),i=32*o+o-1,d=!0;if("horizontal"===r.direction){for(let e=1;e<r.shipLength;e++)null===t.board[a+e][n]&&void 0!==t.board[a+e][n]||(d=!1);if(!1===d)return;e.srcElement.parentElement.style.flexDirection="column",e.srcElement.parentElement.style.width="32px",e.srcElement.parentElement.style.height=i+"px",t.removeShip(a,n,r,"horizontal"),t.placeShip(a,n,r,"vertical"),r.direction="vertical"}else if("vertical"===r.direction){for(let e=1;e<r.shipLength;e++)null===t.board[a][n+e]&&void 0!==t.board[a][n+e]||(d=!1);if(!1===d)return;e.srcElement.parentElement.style.flexDirection="row",e.srcElement.parentElement.style.width=i+"px",e.srcElement.parentElement.style.height="32px",t.removeShip(a,n,r,"vertical"),t.placeShip(a,n,r,"horizontal"),r.direction="horizontal"}},h=(e,t)=>{!0!==t&&(e.dataTransfer.setData("target",e.target.id),e.dataTransfer.setData("target-length",e.target.dataset.length),e.dataTransfer.setData("srcX",e.srcElement.parentElement.attributes[1].value),e.dataTransfer.setData("srcY",e.srcElement.parentElement.attributes[2].value))},u=(e,t)=>{!0!==t&&(e.preventDefault(),e.dataTransfer.dropEffect="move")},m=(e,t,l,a)=>{if(!0===l)return;e.preventDefault();let n=e.dataTransfer.getData("target"),r=e.dataTransfer.getData("target-length"),o=Number(e.dataTransfer.getData("srcX")),i=Number(e.dataTransfer.getData("srcY")),d=Number(e.target.dataset.x),s=Number(e.target.dataset.y);if(isNaN(d)||isNaN(s))return;let c=t.board[o][i],p=!0;if("horizontal"===c.direction){for(let e=0;e<r;e++)(null!==t.board[d][s+e-a+1]&&t.board[d][s+e-a+1]!==c||void 0===t.board[d][s+e-a+1])&&(p=!1);if(!p)return;p&&(2==a?(d=e.target.dataset.x,s=e.target.dataset.y-1):3==a?(d=e.target.dataset.x,s=e.target.dataset.y-2):4==a?(d=e.target.dataset.x,s=e.target.dataset.y-3):5==a&&(d=e.target.dataset.x,s=e.target.dataset.y-4),document.querySelector(`.battle-cell-content.battle-cell-content__player[data-x="${d}"][data-y="${s}"]`).appendChild(document.getElementById(n)),t.removeShip(o,i,c,"horizontal"),t.placeShip(d,s,c,"horizontal"))}else if("vertical"===c.direction){for(let e=0;e<r;e++)(null!==t.board[d+e-a+1][s]&&t.board[d+e-a+1][s]!==c||void 0===t.board[d+e-a+1][s])&&(p=!1);if(!p)return;p&&(2==a?(d=e.target.dataset.x-1,s=e.target.dataset.y):3==a?(d=e.target.dataset.x-2,s=e.target.dataset.y):4==a?(d=e.target.dataset.x-3,s=e.target.dataset.y):5==a&&(d=e.target.dataset.x-4,s=e.target.dataset.y),document.querySelector(`.battle-cell-content.battle-cell-content__player[data-x="${d}"][data-y="${s}"]`).appendChild(document.getElementById(n)),t.removeShip(o,i,c,"vertical"),t.placeShip(d,s,c,"vertical"))}},b=(e,t,l,a,n,r)=>{if(l.isHit(e,t)||l.isMiss(e,t))b(o(),i(),l,a,n,r);else{l.receiveAttack(e,t);let r=document.querySelector(`[class$="battle-cell-content battle-cell-content__player"][data-x="${e}"][data-y="${t}"]`);const o=document.querySelector(".result");let i=r.innerHTML;if(l.isHit(e,t))if(i){var d=document.createElement("div");d.style.backgroundColor="red",d.style.position="absolute",d.style.top="0",d.style.width="100%",d.style.height="100%",d.style.zIndex="10",d.innerHTML="X",r.appendChild(d)}else r.style.position="relative",r.innerHTML="X",r.style.zIndex="3",r.style.backgroundColor="red";else l.isMiss(e,t)&&(r.innerHTML="ã€‚");l.setProbabilityBoardToZero(),l.calculateProbability(),l.isAllShipSink()?(o.innerHTML="Bot won!",f(!0)):a.turn=n.name}};let y=!1;const f=e=>{y=e},g=(e,t)=>{e.direction=t};(()=>{const t=document.createElement("header"),l=document.createElement("a");l.href="#",l.onclick=t=>{e(t)};const a=document.createElement("h2");a.className="site-name",a.innerHTML="<span>B</span><span>a</span><span>t</span><span>t</span><span>l</span><span>e</span><span>s</span><span>h</span><span>i</span><span>p</span>",document.body.prepend(t),t.appendChild(l),l.appendChild(a);const n=document.createElement("nav"),r=document.createElement("ul"),o=document.createElement("li"),i=document.createElement("a");i.href="#home",i.onclick=t=>{e(t)};const d=document.createTextNode("Home");i.appendChild(d),o.appendChild(i),r.appendChild(o);const s=document.createElement("li"),c=document.createElement("a");c.href="#how-to-play",c.onclick=t=>{e(t)};const p=document.createTextNode("How To Play");c.appendChild(p),s.appendChild(c),r.appendChild(s);const h=document.createElement("li"),u=document.createElement("a");u.href="https://github.com/williamphk/odin_Battleship";const m=document.createTextNode("Source Code");u.appendChild(m),h.appendChild(u),r.appendChild(h),t.appendChild(n),n.appendChild(r)})(),(()=>{const e=document.createElement("main");document.getElementsByTagName("header")[0].after(e),(()=>{const e=document.createElement("div");e.className="how-to-play";const t=screen.width;e.style.position="absolute",e.style.left=-t+"px";const l=document.createElement("h3"),a=document.createElement("h3"),n=document.createElement("h3"),r=document.createTextNode("Gameplay"),o=document.createTextNode("Game Rules"),i=document.createTextNode("Controls"),d=document.createElement("ol");d.className="gameplay-list";const s=document.createElement("li"),c=document.createElement("li"),p=document.createElement("li"),h=document.createElement("li"),u=document.createElement("li"),m=document.createTextNode("The game board consists of a 10x10 grid where you and the Bot will place your battleships and attempt to sink each other's ships."),b=document.createTextNode("You have a fleet of 5 ships: one 5-cell ship, one 4-cell ship, two 3-cell ships and one 2-cell ships. The Bot also has the same fleet."),y=document.createTextNode("You will arrange your ships on the board to where you want them to be, either vertically or horizontally."),f=document.createTextNode("Once all ships are placed, you and the Bot will take turns to fire at each other's ships by clicking on a cell on the board. If you hit a ship, the cell will turn red. If you miss, nothing will happen."),g=document.createTextNode("The game ends when all the cells of a ship are hit, and the player who sinks all the opponent's ships wins.");d.appendChild(s),d.appendChild(c),d.appendChild(p),d.appendChild(h),d.appendChild(u),s.appendChild(m),c.appendChild(b),p.appendChild(y),h.appendChild(f),u.appendChild(g);const E=document.createElement("ul");E.className="game-rules-list";const C=document.createElement("li"),v=document.createElement("li"),x=document.createElement("li"),S=document.createTextNode("You cannot place your ships diagonally or overlap them."),T=document.createTextNode("You cannot change the position of your ships once the game has started."),N=document.createTextNode("You cannot fire at the same cell twice.");E.appendChild(C),E.appendChild(v),E.appendChild(x),C.appendChild(S),v.appendChild(T),x.appendChild(N);const L=document.createElement("ul");L.className="controls-list";const B=document.createElement("li"),w=document.createElement("li"),k=document.createElement("li");B.innerHTML="<kbd>Drag</kbd> and <kbd>Drop</kbd> the ships on the board",w.innerHTML="Single <kbd>Click</kbd> to rotate them",k.innerHTML="press <kbd>Start</kbd> and try to defeat the Bot! Good luck!",L.appendChild(B),L.appendChild(w),L.appendChild(k),l.appendChild(r),a.appendChild(o),n.appendChild(i),e.appendChild(l),e.appendChild(d),e.appendChild(a),e.appendChild(E),e.appendChild(n),e.appendChild(L),document.querySelector("main").appendChild(e)})(),(()=>{const e=document.createElement("div");e.className="game";const n=document.createElement("h3");n.className="result",e.appendChild(n);const r=document.createElement("div");r.className="battlefields";const o=document.createElement("div"),i=document.createElement("div"),d=document.createElement("h2"),s=document.createElement("h2");d.innerHTML="Your board",s.innerHTML="Enemy's board",o.appendChild(d),i.appendChild(s),r.appendChild(o),r.appendChild(i);const c=document.querySelector("main");e.appendChild(r),c.appendChild(e),o.className="player-battlefield",i.className="bot-battlefield";const p=document.createElement("table"),h=document.createElement("table");p.className="battlefield-table-container__player",h.className="battlefield-table-container__bot",o.appendChild(p),i.appendChild(h);for(let e=0;e<10;e++){const t=document.createElement("tr"),l=document.createElement("tr");t.className="battiefield-row__player",l.className="battiefield-row__bot",p.appendChild(t),h.appendChild(l);for(let a=0;a<10;a++){const n=document.createElement("td"),r=document.createElement("td");n.className="battlefield-cell",r.className="battlefield-cell";const o=document.createElement("div"),i=document.createElement("div");o.className="battle-cell-content battle-cell-content__player",i.className="battle-cell-content battle-cell-content__bot",o.dataset.x=e,o.dataset.y=a,i.dataset.x=e,i.dataset.y=a,t.appendChild(n),l.appendChild(r),n.appendChild(o),r.appendChild(i)}}const u=t(1,2,"64.25px"),m=t(2,3,"96.6px"),b=t(3,3,"96.6px"),y=t(4,4,"129px"),f=t(5,5,"161.2px"),g=l(1),E=l(2),C=l(1),v=l(2),x=l(3),S=l(1),T=l(2),N=l(3),L=l(1),B=l(2),w=l(3),k=l(4),M=l(1),z=l(2),_=l(3),H=l(4),q=l(5);u.appendChild(g),u.appendChild(E),m.appendChild(C),m.appendChild(v),m.appendChild(x),b.appendChild(S),b.appendChild(T),b.appendChild(N),y.appendChild(L),y.appendChild(B),y.appendChild(w),y.appendChild(k),f.appendChild(M),f.appendChild(z),f.appendChild(_),f.appendChild(H),f.appendChild(q),a(u,m,b,y,f);const A=document.createElement("button");A.className="start-btn",A.id="start-btn",A.textContent="Start",e.appendChild(A)})()})(),(()=>{const e=document.createElement("footer"),t=document.createElement("p"),l=document.createTextNode(`Â© ${(new Date).getFullYear()}, William Poon`);t.appendChild(l),e.appendChild(t),document.querySelector("main").after(e)})(),(()=>{const e=r("ship1",2,"horizontal","player"),t=r("ship2",3,"horizontal","player"),l=r("ship3",3,"horizontal","player"),o=r("ship4",4,"horizontal","player"),i=r("ship5",5,"horizontal","player"),d=r("ship1",2,"horizontal","bot"),E=r("ship2",3,"horizontal","bot"),C=r("ship3",3,"horizontal","bot"),v=r("ship4",4,"horizontal","bot"),x=r("ship5",5,"horizontal","bot"),S=[d,E,C,v,x];let T=s([e,t,l,o,i]),N=s(S),L=!1;c(e,t,l,o,i,d,E,C,v,x,T,N);let B=n("Player"),w=n("Bot");const k={turn:B.name};document.querySelectorAll(".battle-cell-content__bot").forEach(((e,t)=>{e.addEventListener("click",(()=>((e,t,l,a,n,r,o,i,d)=>{if(!l)return;if(n.turn===d.name)return;if("ã€‚"===e.innerHTML||"X"===e.innerHTML)return;if(a)return;const s=document.querySelectorAll(".battle-cell-content__bot"),c=document.querySelector(".result");r.receiveAttack(s[t].dataset.x,s[t].dataset.y),r.isHit(s[t].dataset.x,s[t].dataset.y)?(e.innerHTML="X",e.style.backgroundColor="red"):r.isMiss(s[t].dataset.x,s[t].dataset.y)&&(e.innerHTML="ã€‚"),r.isAllShipSink()?(c.innerHTML="You won!",f(!0)):(n.turn=d.name,o.setProbabilityBoardToZero(),o.calculateProbability(),b(o.bestNextMove()[0],o.bestNextMove()[1],o,n,i,r,a))})(e,t,L,y,k,N,T,B,w)))}));let M=null;const z=document.querySelectorAll(".ship-sub-div");for(let e=0;e<z.length;e++)z[e].addEventListener("mouseover",(e=>{M=e.target.getAttribute("data-div")}));const _=document.querySelectorAll(".ship");for(let e=0;e<_.length;e++)_[e].addEventListener("click",(e=>p(e,T,L))),_[e].addEventListener("dragstart",(e=>h(e,L))),_[e].addEventListener("dragend",(e=>{}));const H=document.querySelectorAll(".battlefield-cell");for(let e=0;e<H.length;e++)H[e].addEventListener("dragover",(e=>u(e,L))),H[e].addEventListener("drop",(e=>m(e,T,L,M)));document.getElementById("start-btn").addEventListener("click",(n=>{((e,t,l,n,r,o,i,d,s,p,h,u,m)=>{const b=document.getElementsByClassName("battlefield-cell"),y=document.querySelectorAll(".ship");switch(e.target.innerHTML){case"Start":console.log("Game started"),e.target.innerHTML="Restart";for(let e=0;e<b.length;e++)b[e].classList.toggle("battlefield-cell--active");y.forEach((e=>{e.draggable=!1}));break;case"Restart":console.log("Game restarted"),e.target.innerHTML="Start";for(let e=0;e<b.length;e++)b[e].classList.toggle("battlefield-cell--active");y.forEach((e=>{e.draggable=!0})),g(t,"horizontal"),g(l,"horizontal"),g(n,"horizontal"),g(r,"horizontal"),g(o,"horizontal"),c(t,l,n,r,o,i,d,s,p,h,u,m);const f=document.getElementById("drag1"),E=document.getElementById("drag2"),C=document.getElementById("drag3"),v=document.getElementById("drag4"),x=document.getElementById("drag5");document.querySelectorAll(".ship").forEach((e=>{let t=32*e.dataset.length;e.style.flexDirection="row",e.style.width=t+"px",e.style.height="32px"})),document.querySelectorAll(".battle-cell-content").forEach((e=>{e.innerHTML="",e.style.removeProperty("background-color"),e.style.removeProperty("z-index"),e.style.removeProperty("position")})),a(f,E,C,v,x),u.setProbabilityBoardToZero(),u.calculateProbability(),document.querySelector(".result").innerHTML=""}})(n,e,t,l,o,i,d,E,C,v,x,T,N),L=!L,!0===y&&(y=!1)}))})()}();