!function(){"use strict";const e=(e,t,l,n)=>{if(t>4||t<1)throw new Error("Wrong Length");return{shipName:e,shipLength:t,direction:l,group:n,array:[...Array(t)],hit(e){if(e>=this.array.shipLength||e<0)throw new Error("Wrong Position");this.array[e]="hit"},isSink(){return this.array.every((e=>"hit"===e))}}},t=()=>Math.floor(10*Math.random()),l=()=>Math.floor(10*Math.random()),n=()=>{let e=Math.floor(2*Math.random());return 0===e?"horizontal":1===e?"vertical":void 0},a=()=>({board:[[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null]],placeShip(e,n,a,r,o=0){let i=!0;if("horizontal"===r){for(let t=0;t<a.shipLength;t++)(null!==this.board[e][n+t-o]&&this.board[e][n+t-o]!==a||void 0===this.board[e][n+t-o])&&(i=!1);if(i){this.board[e][n]=a;for(let t=0;t<a.shipLength;t++)this.board[e][n+t]=a}else i||(console.log("random!"),this.placeShip(t(),l(),a,r))}else if("vertical"===r){for(let t=0;t<a.shipLength;t++)(null!==this.board[e+t-o][n]&&this.board[e+t-o][n]!==a||void 0===this.board[e+t-o][n])&&(i=!1);if(i){this.board[e][n]=a;for(let t=0;t<a.shipLength;t++)this.board[e+t][n]=a}else i||this.placeShip(t(),l(),a,r)}},removeShip(e,t,l,n){if("horizontal"===n)for(let n=0;n<l.shipLength;n++)this.board[e][t+n]=null;else if("vertical"===n)for(let n=0;n<l.shipLength;n++)this.board[e+n][t]=null},receiveAttack(e,t){"ship"===this.board[e][t]||"object"==typeof this.board[e][t]&&null!=this.board[e][t]?this.board[e][t]="hit":null===this.board[e][t]&&(this.board[e][t]="missed")},isMiss(e,t){return"missed"===this.board[e][t]},isHit(e,t){return"hit"===this.board[e][t]},isAllShipSink(){return!this.board.some((e=>e.some((e=>"object"==typeof e&&null!==e||"ship"===e))))},hitCount(){let e=0;for(let t=0;t<this.board.length;t++)for(let l=0;l<this.board[t].length;l++)"hit"===this.board[t][l]&&e++;return e}}),r=e=>({name:e});function o(e,t,l){if(!0===l)return;let n=Number(e.srcElement.parentElement.parentElement.attributes[1].value),a=Number(e.srcElement.parentElement.parentElement.attributes[2].value),r=t.board[n][a],o=Number(e.srcElement.parentElement.dataset.length),i=32*o+o-1,d=!0;if("horizontal"===r.direction){for(let e=1;e<r.shipLength;e++)null===t.board[n+e][a]&&void 0!==t.board[n+e][a]||(d=!1);if(console.log(d),!1===d)return;e.srcElement.parentElement.style.flexDirection="column",e.srcElement.parentElement.style.width="32px",e.srcElement.parentElement.style.height=i+"px",t.removeShip(n,a,r,"horizontal"),t.placeShip(n,a,r,"vertical"),r.direction="vertical"}else if("vertical"===r.direction){for(let e=1;e<r.shipLength;e++)null===t.board[n][a+e]&&void 0!==t.board[n][a+e]||(d=!1);if(console.log(d),!1===d)return;e.srcElement.parentElement.style.flexDirection="row",e.srcElement.parentElement.style.width=i+"px",e.srcElement.parentElement.style.height="32px",t.removeShip(n,a,r,"vertical"),t.placeShip(n,a,r,"horizontal"),r.direction="horizontal"}}function i(e,t){console.log(e.target.id),!0!==t&&(e.dataTransfer.setData("target",e.target.id),e.dataTransfer.setData("target-length",e.target.dataset.length),e.dataTransfer.setData("srcX",e.srcElement.parentElement.attributes[1].value),e.dataTransfer.setData("srcY",e.srcElement.parentElement.attributes[2].value),e.target.classList.add("dragging"))}function d(e,t){!0!==t&&(e.preventDefault(),e.dataTransfer.dropEffect="move")}function c(e,t){!0!==t&&e.target.classList.remove("dragging")}function s(e,t,l,n){if(console.log("drop"),!0===l)return;e.preventDefault();let a=e.dataTransfer.getData("target"),r=e.dataTransfer.getData("target-length"),o=Number(e.dataTransfer.getData("srcX")),i=Number(e.dataTransfer.getData("srcY")),d=Number(e.target.dataset.x),c=Number(e.target.dataset.y);if(isNaN(d)||isNaN(c))return;let s=t.board[o][i],u=!0;if("horizontal"===s.direction){for(let e=0;e<r;e++)(null!==t.board[d][c+e-n+1]&&t.board[d][c+e-n+1]!==s||void 0===t.board[d][c+e-n+1])&&(u=!1);if(console.log(u),!u)return;u&&(2==n?(d=e.target.dataset.x,c=e.target.dataset.y-1):3==n?(d=e.target.dataset.x,c=e.target.dataset.y-2):4==n&&(d=e.target.dataset.x,c=e.target.dataset.y-3),document.querySelector(`.battle-cell-content.battle-cell-content__player[data-x="${d}"][data-y="${c}"]`).appendChild(document.getElementById(a)),t.removeShip(o,i,s,"horizontal"),t.placeShip(d,c,s,"horizontal",Number(n)),console.log(t.board))}else if("vertical"===s.direction){for(let e=0;e<r;e++)(null!==t.board[d+e-n+1][c]&&t.board[d+e-n+1][c]!==s||void 0===t.board[d+e-n+1][c])&&(u=!1);if(console.log(u),!u)return;u&&(2==n?(d=e.target.dataset.x-1,c=e.target.dataset.y):3==n?(d=e.target.dataset.x-2,c=e.target.dataset.y):4==n&&(d=e.target.dataset.x-3,c=e.target.dataset.y),document.querySelector(`.battle-cell-content.battle-cell-content__player[data-x="${d}"][data-y="${c}"]`).appendChild(document.getElementById(a)),t.removeShip(o,i,s,"vertical"),t.placeShip(d,c,s,"vertical",Number(n)),console.log(t.board))}}const u=(e,n,a,r,o,i,d)=>{if(a.isHit(e,n)||a.isMiss(e,n))u(t(),l(),a,r,o,i);else{a.receiveAttack(e,n);let t=document.querySelector(`[class$="battle-cell-content battle-cell-content__player"][data-x="${e}"][data-y="${n}"]`),l=t.innerHTML;const d=document.querySelector(".result");if(a.isHit(e,n))if(console.log("x",e,"y",n),l){var c=document.createElement("div");c.style.backgroundColor="red",c.style.position="absolute",c.style.top="0",c.style.width="100%",c.style.height="100%",c.style.zIndex="10",c.innerHTML="H",t.appendChild(c),document.getElementById("hit-count").innerHTML=`You hit: ${i.hitCount()} AI hit: ${a.hitCount()}`}else t.style.position="relative",t.innerHTML="H",t.style.zIndex="3",t.style.backgroundColor="red";else a.isMiss(e,n)&&(t.innerHTML="M");a.isAllShipSink()?(d.innerHTML="AI win",document.getElementById("start-btn").innerHTML="Restart",document.getElementById("start-btn").onclick=()=>{window.location.reload()}):r.turn=o.name}};function p(e,t,l){const n=document.createElement("div");return n.className="ship",n.id="drag"+e,n.setAttribute("data-length",t),n.setAttribute("draggable",!0),n.style.width=l,n}function h(e){const t=document.createElement("div");return t.className="ship-sub-div",t.style.width="32px",t.style.height="32px",t.setAttribute("data-div",e),t}!function(){console.log("dom");const e=document.querySelector(".player-battlefield"),t=document.querySelector(".bot-battlefield"),l=document.createElement("table"),n=document.createElement("table");console.log(l,n),l.className="battlefield-table-container__player",n.className="battlefield-table-container__bot",e.appendChild(l),t.appendChild(n);for(let e=0;e<10;e++){const t=document.createElement("tr"),a=document.createElement("tr");t.className="battiefield-row__player",a.className="battiefield-row__bot",l.appendChild(t),n.appendChild(a);for(let l=0;l<10;l++){const n=document.createElement("td"),r=document.createElement("td");n.className="battlefield-cell",r.className="battlefield-cell";const o=document.createElement("div"),i=document.createElement("div");o.className="battle-cell-content battle-cell-content__player",i.className="battle-cell-content battle-cell-content__bot",o.dataset.x=e,o.dataset.y=l,i.dataset.x=e,i.dataset.y=l,t.appendChild(n),a.appendChild(r),n.appendChild(o),r.appendChild(i)}}const a=p(1,1,"32px"),r=p(2,1,"32px"),o=p(3,1,"32px"),i=p(4,1,"32px"),d=p(5,2,"65px"),c=p(6,2,"65px"),s=p(7,2,"65px"),u=p(8,3,"98px"),b=p(9,3,"98px"),m=p(10,4,"131px"),y=h(1),g=h(1),f=h(1),S=h(1),E=h(1),v=h(2),C=h(1),x=h(2),z=h(1),_=h(2),L=h(1),N=h(2),q=h(3),M=h(1),T=h(2),A=h(3),w=h(1),H=h(2),k=h(3),I=h(4);a.appendChild(y),r.appendChild(g),o.appendChild(f),i.appendChild(S),d.appendChild(E),d.appendChild(v),c.appendChild(C),c.appendChild(x),s.appendChild(z),s.appendChild(_),u.appendChild(L),u.appendChild(N),u.appendChild(q),b.appendChild(M),b.appendChild(T),b.appendChild(A),m.appendChild(w),m.appendChild(H),m.appendChild(k),m.appendChild(I),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="0"][data-y="0"]').appendChild(a),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="0"][data-y="3"]').appendChild(r),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="0"][data-y="6"]').appendChild(o),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="0"][data-y="9"]').appendChild(i),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="2"][data-y="1"]').appendChild(d),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="2"][data-y="7"]').appendChild(c),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="3"][data-y="4"]').appendChild(s),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="6"][data-y="1"]').appendChild(u),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="6"][data-y="6"]').appendChild(b),document.querySelector('.battle-cell-content.battle-cell-content__player[data-x="8"][data-y="3"]').appendChild(m)}();let b=!1;const m=e("ship1",1,"horizontal","player"),y=e("ship2",1,"horizontal","player"),g=e("ship3",1,"horizontal","player"),f=e("ship4",1,"horizontal","player"),S=e("ship5",2,"horizontal","player"),E=e("ship6",2,"horizontal","player"),v=e("ship7",2,"horizontal","player"),C=e("ship8",3,"horizontal","player"),x=e("ship9",3,"horizontal","player"),z=e("ship10",4,"horizontal","player"),_=e("ship1",1,"horizontal","bot"),L=e("ship2",1,"horizontal","bot"),N=e("ship3",1,"horizontal","bot"),q=e("ship4",1,"horizontal","bot"),M=e("ship5",2,"horizontal","bot"),T=e("ship6",2,"horizontal","bot"),A=e("ship7",2,"horizontal","bot"),w=e("ship8",3,"horizontal","bot"),H=e("ship9",3,"horizontal","bot"),k=e("ship10",4,"horizontal","bot");let I=a(),$=a();console.log(I),console.log($),$.placeShip(t(),l(),m,n()),$.placeShip(t(),l(),y,n()),$.placeShip(t(),l(),g,n()),$.placeShip(t(),l(),f,n()),$.placeShip(t(),l(),S,n()),$.placeShip(t(),l(),E,n()),$.placeShip(t(),l(),v,n()),$.placeShip(t(),l(),C,n()),$.placeShip(t(),l(),x,n()),$.placeShip(t(),l(),z,n()),I.placeShip(0,0,_,"horizontal"),I.placeShip(0,3,L,"horizontal"),I.placeShip(0,6,N,"horizontal"),I.placeShip(0,9,q,"horizontal"),I.placeShip(2,1,M,"horizontal"),I.placeShip(2,7,T,"horizontal"),I.placeShip(3,4,A,"horizontal"),I.placeShip(6,1,w,"horizontal"),I.placeShip(6,6,H,"horizontal"),I.placeShip(8,3,k,"horizontal"),console.log(I.board);let D=r("Player"),B=r("Bot");console.log(D);const Y={turn:D.name};document.querySelectorAll(".battle-cell-content__bot").forEach(((e,n)=>{e.addEventListener("click",(()=>function(e,n,a,r,o,i,d,c,s){if(!a)return;if(r.turn===s.name)return;if("。"===e.innerHTML)return;if(d)return;const p=document.getElementById("hit-count");p.innerHTML=`You hit: ${o.hitCount()} AI hit: ${i.hitCount()}`;const h=document.querySelectorAll(".battle-cell-content__bot"),b=document.querySelector(".result");e.innerHTML="。",o.receiveAttack(h[n].dataset.x,h[n].dataset.y),o.isAllShipSink()?(b.innerHTML="You win",p.innerHTML=`You hit: ${o.hitCount()} AI hit: ${i.hitCount()}`,d=!0,document.getElementById("start-btn").innerHTML="Restart",document.getElementById("start-btn").onclick=()=>{window.location.reload()}):(r.turn=s.name,u(t(),l(),i,r,c,o,d))}(e,n,b,Y,$,I,!1,D,B)))}));let j=null;const P=document.querySelectorAll(".ship-sub-div");for(let e=0;e<P.length;e++)P[e].addEventListener("mouseover",(e=>{j=e.target.getAttribute("data-div"),console.log(j)}));const R=document.querySelectorAll(".ship");for(let e=0;e<R.length;e++)R[e].addEventListener("click",(e=>o(e,I,b))),R[e].addEventListener("dragstart",(e=>i(e,b))),R[e].addEventListener("dragend",(e=>c(e,b)));const W=document.querySelectorAll(".battlefield-cell");for(let e=0;e<W.length;e++)W[e].addEventListener("dragover",(e=>d(e,b))),W[e].addEventListener("drop",(e=>s(e,I,b,j)));document.getElementById("start-btn").onclick=()=>{document.querySelectorAll(".battlefield-cell").forEach((e=>{e.style.borderTop="0.5px solid rgb(0, 38, 255)",e.style.borderLeft="0.5px solid rgb(0, 38, 255)",e.style.backgroundColor="rgb(228, 228, 228)"})),b=!0}}();